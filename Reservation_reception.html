<!DOCTYPE html> 
    <html lang="ko">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/lib/bootstrap.min.css">
        <Title>예약 접수</Title>
    </head>
    <body>
        <header>header
            <button><a href="main.html">처음으로</a></button>
            <button><a href="index.html">임시버튼</a></button>
            <form onsubmit="showSubmitMessage(); return false;">
                <label for="name">이름:</label>
                <input type="text" id="name" name="name" placeholder="검색" style="opacity: 0.7;">
                <input type="submit" value="제출">
            </form>
        </header>
        <aside>
            <ol>AS
                <li><a href="Repair_in_progress_list.html">진행중</a></li>
                <li><a href="complete.html">완료</a></li>
                <li><a href="Reservation_reception2.html">예약접수</a></li>
            </ol>
            <ul>
                <li><a href="#">부품사용</a></li>
                <li><a href="#">선발송</a></li>
                <li><a href="#">제공</a></li>
            </ul>
        </aside>
        <main>
            <form id="dataForm">
            <div class="box">
                <div>
                    <button>임시저장</button>
                    <button type="submit">저장</button>
                    <button>예약하기</button>                
                </div>
                <div class="box">
                    <select class="select-01" name="접수방법">
                        <option value="" disabled selected>접수 방법 선택</option>
                        <option value="예약방문">예약방문</option>
                        <option value="방문">방문</option>
                        <option disabled >-----</option>
                        <option value="영업 외 시간 놓고 감">영업 외 시간 놓고 감</option>
                        <option value="맡기고 감">예약 후 맡기고 감</option>
                        <option disabled >-----</option>
                        <option value="퀵 서비스">퀵 서비스</option>
                        <option value="택배">택배</option>
                    </select>
                </div>
                <div>
                    <select class="select-02" name="AS후수령방법">
                        <option value="" disabled selected>AS 후 수령 방법 선택</option>
                        <option value="전화 주면 방문">전화 주면 방문</option>
                        <option value="기다림">기다림</option>
                        <option disabled >-----</option>
                        <option value="영업 외 시간 놓고 감">영업 외 시간 찾아 감</option>
                        <option value="맡기고 감">맡기고 감</option>
                        <option disabled >-----</option>
                        <option value="퀵 서비스">퀵 서비스</option>
                        <option value="택배">택배</option>
                    </select>
                </div>
            
                <div>
                    <input type="text" id="model" name="모델" placeholder="모델" required>
                    <input type="text" id="distance" name="주행거리" placeholder="주행거리" required oninput="appendKm()">
                    <input type="text" id="store" name="구입처" placeholder="구입처" required><br>
                    <input type="text" id="name1" name="이름" placeholder="이름" required>
                    <input type="tel" id="contact" name="pk_phone" placeholder="연락처" required><br>
                    <input type="text" id="address" name="주소" placeholder="주소" required class="wide">
                </div>
                <div>
                    <label>고장 유형</label><br>
                    <select class="select-03" name="고장유형">
                        <option value="" disabled selected>증상 카테고리</option>
                        <option disabled>↓배터리↓</option>
                        <option value="전화 주면 방문">→ 충전불가</option>
                        <option value="기다림">→ 방전불가</option>
                        <option value="기다림">→ 주행 중 꺼짐</option>
                        <option disabled >↓소음↓</option>
                        <option value="영업 외 시간 놓고 감">→ 주행 중 소음</option>
                        <option value="맡기고 감">→ 기기 소음</option>
                        <option value="맡기고 감">→ 제동 시 소음</option>
                        <option disabled >↓제동문제↓</option>
                        <option value="퀵 서비스">→ 브레이크 작동 불가</option>
                        <option value="택배">→ 블리딩</option>
                        <option disabled >↓휠↓</option>
                        <option value="퀵 서비스">→ 유성기어 파손</option>
                        <option value="택배">→ 모터 제외 휠 교체</option>
                        <option value="퀵 서비스">→ 베어링교체</option>
                        <option value="택배">→ 스포크 파손</option>
                        <option disabled >↓프레임↓</option>
                        <option value="퀵 서비스">→ 프레임 파손</option>
                        <option value="택배">→ 킥스탠드 프레임 파손</option>
                        <option value="퀵 서비스">→ 삼각링크 교체</option>
                        <option value="택배">→ 리코일링</option>
                    </select>
                    <input type="text" id="symptom" name="고장증상" placeholder="고장증상입력" required class="wide3">
                </div>
                <div>
                    결제하실 금액 :
                    <input type="number" name="결제금액">
                </div>
                <div>
                    <input type="radio" name="결제유형" value="무상" onclick="toggleFields()">무상
                    <input type="radio" name="결제유형" value="유상" onclick="toggleFields()">유상
                    <input type="radio" name="결제유형" value="부분유상" onclick="toggleFields()">부분유상
                    <div id="payment-method" class="hidden">
                        <select class="select-04" name="결제방법">
                            <option value="" disabled selected>결제방법선택</option>
                            <option value="카드">카드</option>
                            <option value="현금">현금</option>
                        </select>
                    </div>
                    <div id="receipt-date" class="hidden">
                        영수증 날짜: <input type="date" name="영수증날짜">
                    </div>
                </div>
            </div>
            </form>
        </main>
        <footer>퇴근전 [           ] 꺼내놓기</footer> 
    </body>
  
              
        <div id="content"></div>
        <script src="js/lib/jquery-3.2.1.min.js"></script>
        <script src="js/lib/handlebars.min.js"></script>
        <script src="js/lib/bootstrap.min.js"></script>
        <script src="js/util.js"></script>
        <script id="entry-template" type="text/x-handlebars-template">
            
        </div>
        </script>
        <script>
            document.querySelector('#dataForm').addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(event.target);
                const data = {};// JSON

                formData.forEach((value, key) => {
                    data[key] = value;
                });

                // 작성자
                data.작성자 = '김사원';
                // 진행여부
                data.처리상황 = '진행중';
                // 접수날짜
                data.접수날짜 = getCurrentTimestamp();

                addData("TASK_TABLE", data, function(result) {
                    console.log(result);
                    alert('저장 요청 결과:' + result.message);
                });
            })

            function appendKm() {
                var distanceInput = document.getElementById('distance');
                var value = distanceInput.value;
                var kmSuffix = " km";

                // 숫자만 남기고 나머지는 제거
                var numericValue = value.replace(/\D/g, '');

                // 입력 값이 있을 때만 'km'를 추가
                if (numericValue.length > 0) {
                    distanceInput.value = numericValue + kmSuffix;
                } else {
                    distanceInput.value = "";
                }
            }

            // 무상, 유상, 부분유상 토클 위치에 따른 보이는 메뉴 다르게 하기
            function toggleFields() {
                var radios = document.getElementsByName('결제유형');
                var paymentMethod = document.getElementById('payment-method');
                var receiptDate = document.getElementById('receipt-date');
                var showPaymentSelect = false;
                var showReceiptDate = false;

                for (var i = 0; i < radios.length; i++) {
                    if (radios[i].checked) {
                        if (radios[i].value === '유상' || radios[i].value === '부분유상') {
                            showPaymentSelect = true;
                        } else if (radios[i].value === '무상') {
                            showReceiptDate = true;
                        }
                    }
                }

                if (showPaymentSelect) {
                    paymentMethod.classList.remove('hidden');
                } else {
                    paymentMethod.classList.add('hidden');
                }

                if (showReceiptDate) {
                    receiptDate.classList.remove('hidden');
                } else {
                    receiptDate.classList.add('hidden');
                }
            }

            function getCurrentDateTime() {
                const now = new Date();
                const date = now.toLocaleDateString('ko-KR');
                const time = now.toLocaleTimeString('ko-KR');
                return `${date} ${time}`;
            }
            function getCurrentTimestamp() {
                const now = new Date();

                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더해줌
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');

                return `${year}-${month}-${day}`;
            }
            

            function showSubmitMessage() {
                var result = confirm("제출되었습니다. 다시 검색하시겠습니까?");
                if (result) {
                // Yes 클릭 시 동작
                // 창을 닫는다
                window.close();
                } else {
                // No 클릭 시 동작
                // 아무 동작 없음
                }
            }

                // 모델 리스트 (실제로는 데이터베이스나 API에서 가져오는 것이 일반적)
                const models = [
                    "모델1",
                    "모델2",
                    "모델3",
                    "모델4",
                    // 필요한 만큼 추가
                ];

                // 입력 창과 관련된 JavaScript 코드
                window.onload = function() {
                    const input = document.getElementById('name');

                    // 입력이 바뀔 때마다 자동 완성 기능 실행
                    input.addEventListener('input', function() {
                        const searchText = input.value.trim(); // 입력된 텍스트

                        // 모델 리스트에서 정확히 일치하는 모델 찾기
                        const suggestion = models.find(function(model) {
                            return model === searchText;
                        });

                        // 정확히 일치하는 모델이 있다면 제안
                        if (suggestion) {
                            alert('관련 검색어: ' + suggestion);
                        } else {
                            alert('일치하는 모델이 없습니다.');
                        }
                    });
                };
        </script>
    <script src="js/handlebars.test.js"></script>
        
</html>
